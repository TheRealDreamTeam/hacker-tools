<%= turbo_stream.replace "tool-tags" do %>
  <% if @tool_tags.any? %>
    <div class="d-flex flex-wrap gap-2" data-controller="tooltip">
      <% @tool_tags.each do |tag| %>
        <% 
          badge_class = tag_badge_class(tag)
          tooltip_title = tag.tag_description.presence || tag.display_name
          inline_styles = []
          if tag.respond_to?(:color) && tag.color.present?
            color_hex = color_name_to_hex(tag.color)
            inline_styles << "background-color: #{color_hex};"
            if is_dark_color?(tag.color) || is_dark_background?(color_hex)
              inline_styles << "color: #ffffff !important;"
            else
              inline_styles << "color: #212529 !important;"
            end
          end
        %>
        <span class="badge <%= badge_class %> d-inline-flex align-items-center gap-2" 
              style="<%= inline_styles.join(' ') %>"
              data-bs-toggle="tooltip"
              data-bs-title="<%= tooltip_title %>"
              data-bs-placement="top"
              title="<%= tooltip_title %>">
          <%= link_to tag.display_name, tag_path(tag), target: "_blank", rel: "noopener noreferrer", class: "text-decoration-none", style: "color: inherit;" %>
          <% if admin_user? %>
            <%= button_to "×",
                        remove_tag_tool_path(@tool, tag_id: tag.id),
                        method: :delete,
                        class: "btn btn-link p-0 border-0 bg-transparent shadow-none text-decoration-none",
                        style: "color: inherit; font-size: 1rem; line-height: 1; padding: 0 0 0 0.25rem !important; margin: 0; width: auto; height: auto; text-decoration: none !important;",
                        title: t("tools.actions.remove_tag"),
                        form: { data: { turbo: true }, style: "display: inline;" } %>
          <% end %>
        </span>
      <% end %>
      <% if @all_tool_tags.count > @tool_tags.count %>
        <p class="text-muted small mt-2 mb-0">
          <%= t("tools.show.showing_top_tags", count: @tool_tags.count, total: @all_tool_tags.count) %>
          <button class="btn btn-link btn-sm p-0 text-decoration-none" type="button" data-bs-toggle="collapse" data-bs-target="#all-tags">
            <%= t("tools.show.show_all_tags") %>
          </button>
        </p>
        <div id="all-tags" class="collapse mt-2">
          <div class="d-flex flex-wrap gap-2">
            <% @all_tool_tags.each do |tag| %>
              <% unless @tool_tags.map(&:id).include?(tag.id) %>
                <% 
                  badge_class = tag_badge_class(tag)
                  tooltip_title = tag.tag_description.presence || tag.display_name
                  inline_styles = []
                  if tag.respond_to?(:color) && tag.color.present?
                    color_hex = color_name_to_hex(tag.color)
                    inline_styles << "background-color: #{color_hex};"
                    if is_dark_color?(tag.color) || is_dark_background?(color_hex)
                      inline_styles << "color: #ffffff !important;"
                    else
                      inline_styles << "color: #212529 !important;"
                    end
                  end
                %>
                <span class="badge <%= badge_class %> d-inline-flex align-items-center gap-2" 
                      style="<%= inline_styles.join(' ') %>"
                      data-bs-toggle="tooltip"
                      data-bs-title="<%= tooltip_title %>"
                      data-bs-placement="top"
                      title="<%= tooltip_title %>">
                  <%= link_to tag.display_name, tag_path(tag), target: "_blank", rel: "noopener noreferrer", class: "text-decoration-none", style: "color: inherit;" %>
                  <% if admin_user? %>
                    <%= button_to "×",
                                remove_tag_tool_path(@tool, tag_id: tag.id),
                                method: :delete,
                                class: "btn btn-link p-0 border-0 bg-transparent shadow-none",
                                style: "color: inherit; font-size: 1rem; line-height: 1; padding: 0 0 0 0.25rem !important; margin: 0; width: auto; height: auto;",
                                title: t("tools.actions.remove_tag"),
                                form: { data: { turbo: true }, style: "display: inline;" } %>
                  <% end %>
                </span>
              <% end %>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  <% else %>
    <p class="text-muted mb-0"><%= t("tools.show.no_tags") %></p>
  <% end %>
<% end %>

