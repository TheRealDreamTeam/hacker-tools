<%# Turbo Stream template for account deletion %>
<%# Updates the modal with error messages when password is incorrect %>
<%# Keeps the modal open so user can correct the password %>

<%= turbo_stream.replace "delete-account-modal-content" do %>
  <div class="modal-content" id="delete-account-modal-content">
    <div class="modal-header">
      <h5 class="modal-title" id="delete-account-modal-label"><%= t("account_settings.destroy.modal_title") %></h5>
      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="<%= t("navigation.close") %>"></button>
    </div>
    <%= form_with model: @user, url: account_settings_path, method: :delete, data: { turbo: true }, local: false do |f| %>
      <div class="modal-body" id="delete-account-modal-body">
        <p><%= t("account_settings.destroy.modal_message") %></p>
        <div class="mt-3">
          <%= f.label :password, t("account_settings.destroy.password_label"), class: "form-label" %>
          <%= f.password_field :password, class: "form-control #{'is-invalid' if @user.errors[:delete_account_password].any?}", placeholder: t("account_settings.destroy.password_placeholder"), required: true, autocomplete: "current-password", autofocus: @user.errors[:delete_account_password].any? %>
          <% if @user.errors[:delete_account_password].any? %>
            <div class="invalid-feedback">
              <% @user.errors[:delete_account_password].each do |error| %>
                <div><%= error %></div>
              <% end %>
            </div>
          <% end %>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"><%= t("actions.cancel") %></button>
        <%= f.submit t("account_settings.destroy.confirm_button"), class: "btn btn-outline-danger" %>
      </div>
    <% end %>
  </div>
<% end %>

<%# Keep modal open by ensuring Bootstrap modal instance stays active %>
<%# JavaScript will handle keeping the modal open via Turbo Stream response %>
<%# Password field has autofocus attribute when there are errors %>

