<div id="comment-<%= comment.id %>" class="mb-3 ps-<%= depth * 3 %>">
  <div class="card shadow-sm">
    <div class="card-body">
      <div class="d-flex justify-content-between align-items-start">
        <div class="flex-grow-1">
          <p class="mb-1 fw-semibold"><%= display_user_name(comment.user) %></p>
          <p class="mb-2"><%= simple_format(comment.comment) %></p>
          <p class="text-secondary small mb-0"><%= l(comment.created_at, format: :short) %></p>
        </div>
        <div class="d-flex gap-2 align-items-center">
          <% if comment.commentable_type == "Tool" %>
            <%= button_to upvote_tool_comment_path(comment.commentable, comment),
                          method: :post,
                          class: "btn btn-sm #{comment.upvoted_by?(current_user) ? 'btn-primary' : 'btn-outline-secondary'}",
                          title: comment.upvoted_by?(current_user) ? t("comments.actions.remove_upvote") : t("comments.actions.upvote") do %>
              <span>↑</span> <span><%= comment.upvote_count %></span>
            <% end %>
            <% if comment.user == current_user || (comment.commentable_type == "Tool" && comment.commentable.user == current_user) %>
              <%= button_to t("comments.actions.delete"), tool_comment_path(comment.commentable, comment),
                            method: :delete,
                            data: { turbo_confirm: t("comments.confirmations.delete") },
                            class: "btn btn-sm btn-outline-danger" %>
            <% end %>
          <% elsif comment.commentable_type == "Submission" %>
            <%= button_to upvote_submission_comment_path(comment.commentable, comment),
                          method: :post,
                          class: "btn btn-sm #{comment.upvoted_by?(current_user) ? 'btn-primary' : 'btn-outline-secondary'}",
                          title: comment.upvoted_by?(current_user) ? t("comments.actions.remove_upvote") : t("comments.actions.upvote") do %>
              <span>↑</span> <span><%= comment.upvote_count %></span>
            <% end %>
            <% if comment.user == current_user || (comment.commentable_type == "Submission" && comment.commentable.user == current_user) %>
              <%= button_to t("comments.actions.delete"), submission_comment_path(comment.commentable, comment),
                            method: :delete,
                            data: { turbo_confirm: t("comments.confirmations.delete") },
                            class: "btn btn-sm btn-outline-danger" %>
            <% end %>
          <% end %>
        </div>
      </div>
    </div>
  </div>

  <% if allow_replies %>
    <div class="mt-2 ps-3">
      <button class="btn btn-sm btn-outline-primary" type="button" data-bs-toggle="collapse" data-bs-target="#reply-form-<%= comment.id %>" aria-expanded="false" aria-controls="reply-form-<%= comment.id %>">
        <%= t("comments.actions.reply") %>
      </button>
      <div class="collapse mt-2" id="reply-form-<%= comment.id %>">
        <%= render "comments/form",
                    commentable: comment.commentable,
                    comment: Comment.new(parent: comment, comment_type: :comment),
                    submit_label: t("comments.actions.reply"),
                    placeholder: t("comments.form.reply_placeholder"),
                    show_cancel: true,
                    collapse_target: "reply-form-#{comment.id}" %>
      </div>
    </div>
  <% end %>

  <% comment.replies.each do |reply| %>
    <%= render "comments/comment", comment: reply, depth: depth + 1, allow_replies: true %>
  <% end %>
</div>

