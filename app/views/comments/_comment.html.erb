<div id="comment-<%= comment.id %>" class="mb-3 ps-<%= depth * 3 %>">
  <div class="card shadow-sm">
    <div class="card-body">
      <div class="d-flex justify-content-between align-items-start">
        <div class="flex-grow-1">
          <p class="mb-1 fw-semibold"><%= display_user_name(comment.user) %></p>
          <p class="mb-2"><%= simple_format(comment.comment) %></p>
          <p class="text-secondary small mb-0"><%= l(comment.created_at, format: :short) %></p>
        </div>
        <div class="d-flex flex-column gap-1 align-items-end">
          <div id="comment-<%= comment.id %>-interactions" class="interaction-buttons d-flex gap-2 align-items-center">
            <% if comment.commentable_type == "Tool" %>
              <div class="interaction-item d-flex flex-column align-items-center gap-0">
                <%= button_to upvote_tool_comment_path(comment.commentable, comment),
                              method: :post,
                              class: "btn btn-sm #{comment.upvoted_by?(current_user) ? 'btn-primary' : 'btn-outline-secondary'} interaction-btn",
                              title: comment.upvoted_by?(current_user) ? t("comments.actions.remove_upvote") : t("comments.actions.upvote"),
                              aria: { label: t("comments.actions.upvote") } do %>
                  <i class="bi <%= comment.upvoted_by?(current_user) ? 'bi-arrow-up-circle-fill text-primary' : 'bi-arrow-up-circle text-secondary' %>"></i>
                <% end %>
                <span class="interaction-count" title="<%= t('comments.actions.upvote') %>" aria-label="<%= t('comments.actions.upvote') %>">
                  <%= comment.upvote_count %>
                </span>
              </div>
            <% elsif comment.commentable_type == "Submission" %>
              <div class="interaction-item d-flex flex-column align-items-center gap-0">
                <%= button_to upvote_submission_comment_path(comment.commentable, comment),
                              method: :post,
                              class: "btn btn-sm #{comment.upvoted_by?(current_user) ? 'btn-primary' : 'btn-outline-secondary'} interaction-btn",
                              title: comment.upvoted_by?(current_user) ? t("comments.actions.remove_upvote") : t("comments.actions.upvote"),
                              aria: { label: t("comments.actions.upvote") } do %>
                  <i class="bi <%= comment.upvoted_by?(current_user) ? 'bi-arrow-up-circle-fill text-primary' : 'bi-arrow-up-circle text-secondary' %>"></i>
                <% end %>
                <span class="interaction-count" title="<%= t('comments.actions.upvote') %>" aria-label="<%= t('comments.actions.upvote') %>">
                  <%= comment.upvote_count %>
                </span>
              </div>
            <% end %>
          </div>
          <div class="d-flex gap-2 align-items-center">
            <% if (comment.commentable_type == "Tool" && comment.user == current_user) || (comment.commentable_type == "Submission" && (comment.user == current_user || comment.commentable.user == current_user)) %>
              <% modal_id = "delete-comment-#{comment.id}-modal" %>
              <% if comment.commentable_type == "Tool" %>
                <%= render "shared/confirmation_modal",
                    id: modal_id,
                    title: t("comments.confirmations.delete_title"),
                    message: t("comments.confirmations.delete"),
                    confirm_text: t("actions.delete"),
                    confirm_class: "btn-outline-danger",
                    form_action: tool_comment_path(comment.commentable, comment),
                    form_method: :delete %>
              <% elsif comment.commentable_type == "Submission" %>
                <%= render "shared/confirmation_modal",
                    id: modal_id,
                    title: t("comments.confirmations.delete_title"),
                    message: t("comments.confirmations.delete"),
                    confirm_text: t("actions.delete"),
                    confirm_class: "btn-outline-danger",
                    form_action: submission_comment_path(comment.commentable, comment),
                    form_method: :delete %>
              <% end %>
              <button type="button" class="btn btn-sm btn-outline-danger" data-bs-toggle="modal" data-bs-target="#<%= modal_id %>">
                <%= t("comments.actions.delete") %>
              </button>
            <% end %>
            <% if allow_replies %>
              <button class="btn btn-sm btn-outline-primary" type="button" data-bs-toggle="collapse" data-bs-target="#reply-form-<%= comment.id %>" aria-expanded="false" aria-controls="reply-form-<%= comment.id %>">
                <%= t("comments.actions.reply") %>
              </button>
            <% end %>
          </div>
        </div>
      </div>
      <% if allow_replies %>
        <div class="collapse mt-2" id="reply-form-<%= comment.id %>">
          <%= render "comments/form",
                      commentable: comment.commentable,
                      comment: Comment.new(parent: comment, comment_type: :comment),
                      submit_label: t("comments.actions.reply"),
                      placeholder: t("comments.form.reply_placeholder"),
                      show_cancel: true,
                      collapse_target: "reply-form-#{comment.id}" %>
        </div>
      <% end %>
    </div>
  </div>

  <div id="comment-<%= comment.id %>-replies">
    <% comment.replies.each do |reply| %>
      <%= render "comments/comment", comment: reply, depth: depth + 1, allow_replies: true %>
    <% end %>
  </div>
</div>

