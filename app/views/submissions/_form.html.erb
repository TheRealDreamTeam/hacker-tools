<%= simple_form_for(@submission, 
    html: { 
      data: { 
        controller: "submission-form",
        submission_form_validate_url_value: validate_url_submissions_path,
        submission_form_submission_id_value: @submission.id || nil,
        action: "submit->submission-form#validateBeforeSubmit"
      }
    }
  ) do |f| %>
  
  <%# Subscribe to Turbo Stream updates if submission exists %>
  <% if @submission.persisted? %>
    <%= turbo_stream_from "submission_#{@submission.id}" %>
  <% end %>
  
  <%# Processing status will be inserted here via Turbo Streams %>
  <div id="submission-processing-status-container"></div>

  <div class="row g-4" data-submission-form-target="formContainer">
    <div class="col-12">
      <label class="form-label fw-semibold mb-2">
        <%= t("submissions.form.submission_url") %>
        <% if @submission.new_record? %>
          <span class="text-danger">*</span>
        <% end %>
      </label>
      <%= f.input :submission_url, 
          label: false,
          required: false,
          hint: t("submissions.form.submission_url_hint"),
          input_html: { 
            class: "form-control",
            placeholder: "https://example.com/article",
            autocomplete: "off",
            data: { 
              submission_form_target: "urlInput",
              action: "input->submission-form#urlChanged"
            }
          } %>
    </div>

    <%# Validation messages %>
    <div class="col-12" data-submission-form-target="validationMessage" style="display: none;"></div>

    <%# Similar submissions warning %>
    <div class="col-12" data-submission-form-target="similarSubmissions" style="display: none;"></div>

    <%# Processing status %>
    <div class="col-12" data-submission-form-target="processingStatus" style="display: none;">
      <div class="alert alert-info d-flex align-items-center">
        <div class="spinner-border spinner-border-sm me-2" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
        <span data-submission-form-target="statusText">Processing...</span>
      </div>
    </div>

    <div class="col-12">
      <label class="form-label fw-semibold mb-2">
        <%= t("submissions.form.author_note") %>
        <span class="text-muted small fw-normal">(<%= t("submissions.form.optional") %>)</span>
      </label>
      <%= f.input :author_note, 
          as: :text, 
          label: false,
          input_html: { 
            class: "form-control",
            rows: 3,
            placeholder: t("submissions.form.author_note_placeholder"),
            data: { submission_form_target: "authorNoteInput" }
          },
          hint: t("submissions.form.author_note_hint") %>
    </div>
  </div>

  <div class="mt-4 pt-3 border-top d-flex gap-2">
    <%= f.button :submit, 
        class: "btn btn-primary btn-lg",
        disabled: true,
        data: { submission_form_target: "submitButton" } do %>
      <i class="bi bi-send me-2"></i>
      <%= t("submissions.form.submit") %>
    <% end %>
    <%= link_to t("actions.cancel"), submissions_path, class: "btn btn-outline-secondary btn-lg" %>
  </div>
<% end %>

