<%# Submissions always have yellow border and subtle yellow background %>
<div class="card mb-3 position-relative card-hover border-start border-4"
     style="background-color: #fffbf0; border-left-color: #FFC65A !important;"
     data-controller="tool-card"
     data-tool-card-url-value="<%= submission_path(submission) %>"
     data-action="click->tool-card#navigate">
  <div class="card-body">
    <div class="row align-items-center">
      <!-- Left content: title, type/status badges, description, tags, about/tools, author -->
      <div class="col-12 col-md-5">
        <div class="d-flex justify-content-between align-items-start mb-1">
          <h5 class="card-title mb-0">
            <% title_text = submission.submission_name.presence || submission.submission_url %>
            <% if local_assigns[:index] %>
              <% title_text = "#{index + 1}. #{title_text}" %>
            <% end %>
            <%= link_to title_text,
                        submission_path(submission),
                        class: "text-decoration-none" %>
          </h5>
        </div>
        <div class="d-flex align-items-center gap-2 mb-2">
          <span class="badge bg-primary" style="font-size: 0.75rem;">
            <%= t("submissions.types.#{submission.submission_type}") %>
          </span>
          <% if submission.status != "completed" %>
            <span class="badge bg-warning text-dark" style="font-size: 0.75rem;">
              <%= t("submissions.statuses.#{submission.status}") %>
            </span>
          <% end %>
        </div>

        <div class="card-description">
          <% description = submission.submission_description.presence || submission.author_note %>
          <% if description.present? %>
            <% description_length = description.length %>
            <% max_length = 150 %>
            <p class="card-text text-muted">
              <%= description %>
              <% if description_length > max_length %>
                <span class="view-more-indicator text-muted">View more..</span>
              <% end %>
            </p>
          <% end %>
        </div>

        <% if submission.tools.any? %>
          <p class="small mb-2 text-secondary">
            <%= raw t("submissions.about_tools", tools: submission.tools.map { |t| link_to(t.tool_name, tool_path(t), class: "text-decoration-none") }.join(", ").html_safe) %>
          </p>
        <% end %>

        <% if submission.tags.any? %>
          <div class="mb-2 d-flex flex-wrap gap-2" data-controller="tooltip">
            <% displayed_tags = submission.tags.limit(5) %>
            <% displayed_tags.each do |tag| %>
              <%= render_tag_link(tag) %>
            <% end %>
            <% if submission.tags.count > 5 %>
              <% hidden_tags = submission.tags.offset(5) %>
              <% hidden_tag_names = hidden_tags.pluck(:tag_name).join(", ") %>
              <span class="badge bg-secondary text-white"
                    data-bs-toggle="tooltip"
                    data-bs-title="<%= hidden_tag_names %>"
                    data-bs-placement="top">
                +<%= submission.tags.count - 5 %>
              </span>
            <% end %>
          </div>
        <% end %>

        <p class="small mb-2 text-secondary">
          <%= t("submissions.by_user", user: link_to(display_user_name(submission.user), profile_path(submission.user.username), class: "text-decoration-none")).html_safe %>
        </p>
      </div>

      <!-- Right content: interaction buttons aligned on the same row -->
      <div class="col-12 col-md-7 d-flex justify-content-md-end justify-content-start align-items-center gap-3 mt-3 mt-md-0">
        <%= render "submissions/interaction_buttons", submission: submission %>
      </div>
    </div>
    <span class="position-absolute bottom-0 end-0 mb-1 me-1">
      <%= render "submissions/read_state", submission: submission %>
    </span>
  </div>
</div>

