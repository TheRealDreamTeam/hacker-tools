<%# Unified card partial that displays both tools and submissions %>
<%# locals: item (hash with :type, :item, :engagement, :created_at), index %>
<% if item[:type] == :tool %>
  <% tool = item[:item] %>
  <% upvotes = item[:engagement] %>
  <div class="card mb-3 position-relative card-hover"
       data-controller="tool-card"
       data-tool-card-url-value="<%= tool_path(tool) %>"
       data-action="click->tool-card#navigate">
    <div class="card-body position-relative">
      <%# Global read/eye icon anchored in the top-right corner of the card for signed-in users %>
      <% if user_signed_in? %>
        <span class="position-absolute top-0 end-0 mt-2 me-2">
          <%= render "tools/read_state", tool: tool %>
        </span>
      <% end %>
      <div class="row align-items-center">
        <!-- Left content: star, title, description, tags -->
        <div class="col-12 col-md-5">
          <div class="d-flex justify-content-between align-items-start mb-1">
            <h5 class="card-title mb-0 flex-grow-1">
              <%= link_to "#{index + 1}. #{tool.tool_name}", tool_path(tool), class: "text-decoration-none" %>
            </h5>
          </div>
          <div class="d-flex align-items-center gap-2 mb-2">
            <span class="badge bg-primary" style="font-size: 0.75rem;">
              <%= t("tools.type") %>
            </span>
          </div>
          <p class="card-text text-muted mb-2"><%= tool.tool_description.presence || t("pages.home.card.description", index: index + 1) %></p>
          <div class="d-flex flex-wrap gap-2" data-controller="tooltip">
            <% displayed_tags = tool.tags.limit(3) %>
            <% if displayed_tags.any? %>
              <% displayed_tags.each do |tag| %>
                <%= render_tag_link(tag, badge_class: "bg-light text-primary border") %>
              <% end %>
            <% else %>
              <% [
                t("pages.home.card.sample_tag_one"),
                t("pages.home.card.sample_tag_two"),
                t("pages.home.card.sample_tag_three")
              ].each do |tag| %>
                <span class="badge bg-light text-primary border"><%= tag %></span>
              <% end %>
            <% end %>
          </div>
        </div>

        <!-- Right content: logo + upvotes aligned on the same row -->
        <div class="col-12 col-md-7 d-flex justify-content-md-end justify-content-start align-items-center gap-3 mt-3 mt-md-0">
          <% if tool.icon.attached? %>
            <div class="border rounded-circle bg-light d-inline-flex align-items-center justify-content-center flex-shrink-0" style="width: 64px; height: 64px;">
              <%= image_tag tool.icon, alt: tool.tool_name, class: "rounded-circle", style: "width: 64px; height: 64px; object-fit: cover;" %>
            </div>
          <% end %>
          <%= render "tools/interaction_buttons", tool: tool %>
        </div>
      </div>
    </div>
  </div>
<% else %>
  <% submission = item[:item] %>
  <% upvotes = item[:engagement] %>
  <div class="card mb-3 position-relative card-hover"
       data-controller="tool-card"
       data-tool-card-url-value="<%= submission_path(submission) %>"
       data-action="click->tool-card#navigate">
    <div class="card-body position-relative">
      <%# Global read/eye icon anchored in the top-right corner of the card for signed-in users %>
      <% if user_signed_in? %>
        <span class="position-absolute top-0 end-0 mt-2 me-2">
          <%= render "submissions/read_state", submission: submission %>
        </span>
      <% end %>
      <div class="row align-items-center">
        <!-- Left content: number, title, description, tags -->
        <div class="col-12 col-md-5">
          <div class="d-flex justify-content-between align-items-start mb-1 position-relative">
            <h5 class="card-title mb-0 flex-grow-1">
              <%= link_to "#{index + 1}. #{submission.submission_name.presence || submission.submission_url}", 
                          submission_path(submission), 
                          class: "text-decoration-none" %>
            </h5>
          </div>
          <div class="d-flex align-items-center gap-2 mb-2">
            <span class="badge bg-primary" style="font-size: 0.75rem;">
              <%= t("submissions.types.#{submission.submission_type}") %>
            </span>
          </div>
          <p class="card-text text-muted mb-2">
            <%= truncate(submission.submission_description.presence || submission.author_note, length: 100) %>
          </p>
          <div class="d-flex flex-wrap gap-2" data-controller="tooltip">
            <% displayed_tags = submission.tags.limit(3) %>
            <% if displayed_tags.any? %>
              <% displayed_tags.each do |tag| %>
                <%= render_tag_link(tag, badge_class: "bg-light text-primary border") %>
              <% end %>
            <% end %>
          </div>
        </div>

        <!-- Right content: icon + upvote button -->
        <div class="col-12 col-md-7 d-flex justify-content-md-end justify-content-start align-items-center gap-3 mt-3 mt-md-0">
          <% if submission.icon.attached? %>
            <div class="border rounded-circle bg-light d-inline-flex align-items-center justify-content-center flex-shrink-0" style="width: 64px; height: 64px;">
              <%= image_tag submission.icon, alt: submission.submission_name, class: "rounded-circle", style: "width: 64px; height: 64px; object-fit: cover;" %>
            </div>
          <% end %>
          <%= render "submissions/interaction_buttons", submission: submission %>
        </div>
      </div>
    </div>
  </div>
<% end %>
